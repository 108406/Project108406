<!DOCTYPE html>
<html lang="utf-8">

<head>
    <title>Plan Yourself</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
        integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/mywork.css">
    <link rel="stylesheet" href="css/triangle.css">
    <link rel="stylesheet" href="css/card-list-color.css">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC|Handlee" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC&display=swap" rel="stylesheet">
</head>

<body>
    <!--------------------------navbar-------------------------------->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="nav-brand">PlanYourself</div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02"
            aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
            <ul class="navbar-nav">
                <li>
                    <a href="member"> <i class="far fa-user fa-lg"></i>會員</a>
                </li>
                <li>
                    <a href="content"><i class="fas fa-book fa-lg"></i>計畫</a>
                </li>
                <li>
                    <a href="mywork"> <i class="far fa-edit fa-lg"></i>我的工作</a>
                </li>
            </ul>
            <form class="search">
                <input class="search-input" type="text" name="search" placeholder="Search">
                <a href="#"><i class="fas fa-search search-icon"></i></a>
            </form>
            <div class="study-logout">
                <button class="btn btn-light btn-navbar-study" type="submit" id="show-carousel">教學<i
                        class="fas fa-question-circle fa-lg" style="padding-left:5px;"></i></button>
                <button class="btn btn-danger btn-navbar-logout" type="submit" style="margin-left:0.5em;">登出</button>
            </div>
        </div>
    </nav>
    <!---------------------------內容---------------------------------->
    <div class="container-fluid">
        <!-----------------------左邊窗格----------------------->
        <div class="slider-left" id="slider-left">
            <div class="left-top">
                <div class="slider-header-name">
                    目前所在位置:
                </div>
                <div class="card mx-auto" style="width: 18rem; height:5rem;">
                    <div class="card-body">
                        <div class="card-title">
                            <div class="slider-card-list">
                                <div class="left-header-list" id="list_name"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            <div class="slider-header-name">移動到:</div>
            <div class="left-bottom">
                <div class="card text-center mx-auto" style="width: 18rem;">
                    <div class="card-body">
                        <div class="card-title">
                            <div class="slider-card-list">
                                <div class="left-header-list">其他列表:</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <select class="form-control" id="options">
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <form class="slider-btn">
                <button type="button" class="btn btn-secondary button-submit" id="return"
                    onclick="javascript:$('option').remove();">返回</button>
                <button type="button" class="btn btn-danger button-submit" style="margin-left:1em;"
                    onclick="javascript:UpdateListWork();">確定</button>
            </form>
        </div>
        <!-----------------------新手教學----------------------->
        <!-- <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="../public/imgs/photo-1.jpg" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="../public/imgs/photo-2.jpg" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="../public/imgs/photo-3.jpg" class="d-block w-100" alt="...">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div> -->
        <!-----------------------每項計畫----------------------->
        <div class="content">
            <div class="typesetting">
                <% for(var i=0; i<items.length; i++) { %>
                <div class="card mywork">
                    <% for(var p=0; p<items[i].project.length; p++) { %>
                    <!-----------------------標題----------------------->
                    <div class="header">
                        <div class="text"><%= items[i].project[p].project_name %></div>
                        <div class="switch-move-top">
                            <% var result = ""; %>
                            <% if (items[i].project[p].project_hint) {
                                    result = "checked";
                                }
                            %>
                            <label class="switch-top">
                                <input type="checkbox" id="projecthint" onclick="<%= "javascript:UpdateProjectLinebotPush('" + 
                                    items[i].project[p].project_id + "', " + 
                                    items[i].project[p].project_hint + ")" %>" <%= result %>>
                                <span class="slider-top round-top"></span>
                            </label>
                        </div>
                    </div>
                    <hr class="highlight">
                    <!-----------------------內容----------------------->
                    <div class="body-show">
                        <!----------------列表---------------->
                        <% for(var lw=0; lw<items[i].listwork.length; lw++) { %>
                        <a href="#" data-toggle="collapse" data-target=<%="#list-work-" + lw %> aria-expanded="true"
                            class="list-a" id="list-1">
                            <div class="card-list-1">
                                <div class="list-header"><%= items[i].listwork[lw].list.list_name %></div>
                                <button class="btn btn-link card-list-btn" type="button" data-toggle="collapse"
                                    data-target=<%="#list-work-" + lw %> aria-expanded="true">
                                    <div class="triangle-1"></div>
                                </button>
                            </div>
                        </a>
                        <!----------------工作---------------->
                        <% for(var w=0; w<items[i].listwork[lw].work.length; w++) { %>
                        <div class="collapse show work-total" id=<%="list-work-" + lw %>>
                            <div class="card-content">
                                <button class="btn btn-link btn-work" type="button" name="left-show" onclick="<%= "javascript:SetListInfo(" + 
                                    JSON.stringify(items[i].options) + ", '" + 
                                    items[i].listwork[lw].listwork_serno + "', '" + 
                                    items[i].listwork[lw].list.list_name + "')" %>">
                                    <i class="fas fa-square"></i></button>
                                <a href="#" class="work-a" data-toggle="modal" data-target="#exampleModal" onclick="
                                    <%= "javascript:SetWorkInfo('" + 
                                    items[i].listwork[lw].work[w].work_id + "', '" + 
                                    items[i].listwork[lw].work[w].work_title + "', '" + 
                                    items[i].listwork[lw].work[w].work_content + "', '" + 
                                    items[i].listwork[lw].work[w].deadline + "', '" + 
                                    items[i].listwork[lw].work[w].tagname1 + "', '" + 
                                    items[i].listwork[lw].work[w].color1 + "', '" + 
                                    items[i].listwork[lw].work[w].tagname2 + "', '" + 
                                    items[i].listwork[lw].work[w].color2 + "', '" +
                                    items[i].listwork[lw].work[w].tagname3 + "', '" + 
                                    items[i].listwork[lw].work[w].color3 + "', '" +
                                    items[i].listwork[lw].work[w].tagname4 + "', '" + 
                                    items[i].listwork[lw].work[w].color4 + "', '" +
                                    items[i].listwork[lw].work[w].tagname5 + "', '" + 
                                    items[i].listwork[lw].work[w].color5 + "', '" +
                                    items[i].listwork[lw].work[w].tagname6 + "', '" + 
                                    items[i].listwork[lw].work[w].color6 + "', '" +
                                    items[i].listwork[lw].work[w].file_name + "', '" + 
                                    items[i].listwork[lw].work[w].file + "', '" + 
                                    items[i].listwork[lw].work[w].principal_photo1 + "', '" + 
                                    items[i].listwork[lw].work[w].principal_photo2 + "')" %>
                                    ">
                                    <%= items[i].listwork[lw].work[w].work_title %>
                                </a>
                                <div class="switch-move">
                                    <label class="upload_cover">
                                        <% var work = JSON.stringify(items[i].listwork[lw].work[w]); %>
                                        <input id="upload_input" type="file"
                                            onchange="<%= "javascript:Upload(this" + "," + work + ")" %>">
                                        <span class="upload_icon"><img src="./imgs/paperclip-2x.png"></span>
                                    </label>
                                    <label class="switch">
                                        <% var result = ""; %>
                                        <% if (items[i].listwork[lw].work[w].work_hint) {
                                                    result = "checked";
                                                }
                                            %>
                                        <input type="checkbox" id="workhint" onclick="<%= "javascript:UpdateWorkLinebotPush('" + 
                                        items[i].listwork[lw].work[w].work_id + "', " + 
                                        items[i].listwork[lw].work[w].work_hint + ")" %>" <%= result %>>
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <% } %>
                        <% } %>
                    </div>
                    <div class="card-footer">
                    </div>
                    <% } %>
                </div>
                <% } %>
            </div>
        </div>
        <!----------------------- Modal ----------------------->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel work_id">work title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true" style="color: #ffffff;">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="modal-text">
                            <p class="modal-text-name"></p>
                        </div>
                        <p class="modal-work-content" id="work_content">
                        </p>
                        <hr>
                        <p class="modal-text-name">截止日期</p>
                        <p class="modal-work-deadline" id="deadline"></p>
                        <hr>
                        <p class="modal-text-name">標籤</p>
                        <div class="tag-edit">
                            <a href="#" class="badge badge-warning" id="tag1"></a>
                            <a href="#" class="badge badge-warning" id="tag2"></a>
                            <a href="#" class="badge badge-warning" id="tag3"></a>
                            <a href="#" class="badge badge-warning" id="tag4"></a>
                            <a href="#" class="badge badge-warning" id="tag5"></a>
                            <a href="#" class="badge badge-warning" id="tag6"></a>
                        </div>
                        <hr>
                        <p class="modal-text-name">檔案</p>
                        <a class="modal-work-file" download>
                            <i class="fas fa-file-archive fa-lg" id="file"></i>
                        </a>
                        <hr>
                        <p class="modal-text-name">負責人</p>
                        <div class="modal-img">
                            <img src="imgs/people1.png" class="modal-img-photo" id="first_principal">
                            <img src="imgs/people1.png" class="modal-img-photo" id="second_principal">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary">編輯</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-----------------------------------scrpit-------------------------------------------->
    <script>
        function UpdateProjectLinebotPush(project_id, value) {
            if ($('#projecthint').is(":checked")) {
                value = true;
            } else {
                value = false;
            }

            $.ajax({
                type: 'POST',
                url: 'mywork/updateProjectLinebotPush',
                data: { project_id: project_id, project_hint: value }
            });
        }

        function UpdateWorkLinebotPush(work_id, value) {
            if ($('#workhint').is(":checked")) {
                value = true;
            } else {
                value = false;
            }

            $.ajax({
                type: 'POST',
                url: 'mywork/updateWorkLinebotPush',
                data: { work_id: work_id, work_hint: value }
            });
        }

        function Upload(input, work) {
            if (input.files && input.files[0]) {
                if (input.files[0].type != "application/x-zip-compressed") {
                    alert("只能上傳zip檔");
                } else {
                    console.log(input.files[0]);
                    var type = input.files[0].type;
                    var reader = new FileReader();

                    // Closure to capture the file information.
                    reader.onload = (function (file) {
                        return function (e) {
                            var base64Data = e.target.result;
                            work.file = base64Data;
                            work.file_name = input.files[0].name;
                            $.ajax({
                                type: 'POST',
                                url: 'mywork/updateFile',
                                // data: { "workUpdate": work }
                                data: { "work_id": work.work_id, "file": work.file }
                            });
                        };
                    })(input.files[0]);
                    // Read in the file as a data URL.
                    reader.readAsDataURL(input.files[0]);
                }
            }

        }

        function SetListInfo(options, listwork_serno, listName) {
            var left = $('#slider-left').css("left");

            if (left == "0px") {
                for (var i = 0; i < options.length; i++) {
                    if (options[i].list_name != listName) {
                        $('#options').append("<option id='" + options[i].list_id + "' value='" + listwork_serno + "'>" + options[i].list_name + "</option>");
                    }
                }
                if ($('#options option').length == 0) {
                    $('#options').append("<option value=''>無其他列表選項</option>");
                }
                $('#list_name').text(listName);
            } else {
                $('option').remove();
            }
        }

        function UpdateListWork() {
            var canSubmit = true;
            var s = document.getElementById('options');
            var listwork_serno = s.options[s.selectedIndex].value;
            var list_id = s.options[s.selectedIndex].id;

            if (listwork_serno == "" && list_id == "") {
                alert("無其他列表選項無法移動工作!");
                canSubmit = false;
            }

            if (canSubmit) {
                $.ajax({
                    type: 'POST',
                    url: 'mywork/updateListWork',
                    data: { listwork_serno: listwork_serno, list_id: list_id }
                });
            }
        }

        function SetWorkInfo(workId, workTitle, workContent, deadline, tagname1, color1, tagname2, color2, tagname3, color3, tagname4, color4, tagname5, color5, tagname6, color6, file_name, file, principal_photo1, principal_photo2) {
            $('#work_id').text(workId);
            $('#work_title').text(workTitle);
            $('#work_content').text(workContent);
            $('#deadline').text(deadline);
            $('#file').text(file_name);
            $('.modal-work-file').attr("href", file);
            console.log(file);

            if (tagname1 != "null") {
                $('#tag1').text(tagname1);
                $('#tag1').css("background", color1);
            }

            if (tagname2 != "null") {
                $('#tag2').text(tagname2);
                $('#tag2').css("background", color2);
            }

            if (tagname3 != "null") {
                $('#tag3').text(tagname3);
                $('#tag3').css("background", color3);
            }

            if (tagname4 != "null") {
                $('#tag4').text(tagname4);
                $('#tag4').css("background", color4);
            }

            if (tagname5 != "null") {
                $('#tag5').text(tagname5);
                $('#tag5').css("background", color5);
            }

            if (tagname6 != "null") {
                $('#tag6').text(tagname6);
                $('#tag6').css("background", color6);
            }

            if (principal_photo1 != "null") {
                $('#first_principal').attr("src", 'data:image/png;base64,' + principal_photo1);
            } else {
                $('#first_principal').attr("src", 'imgs/people1.png');
            }

            if (principal_photo2 != "null") {
                $('#second_principal').attr("src", 'data:image/png;base64,' + principal_photo2);
            } else {
                $('#second_principal').attr("src", 'imgs/people1.png');
            }
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="js/slider-left.js"></script>
    <script src="js/text-show.js"></script>
    <script src="js/list_on_click.js"></script>
    <script src="js/carousel.js"></script>
    <script src="js/width.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!------------------------------------------------------------------------------------->
</body>

</html>